<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OntoWave - Solution Compl√®te</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><polygon points='8,4 24,4 30,16 24,28 8,28 2,16' fill='%23F5A623'/><path d='M6 20 C10 14,22 14,26 20 C22 23,10 23,6 20 Z' fill='%230097D1'/><path d='M10 18 C12 16,20 16,22 18 C20 19,12 19,10 18 Z' fill='%23ffffff' opacity='0.9'/></svg>" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
      :root { --max: 980px; }
      body {
        margin: 0;
        font: 16px/1.5 -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        background: #f8f9fa;
      }
      .container { max-width: var(--max); margin: 0 auto; padding: 1rem; background: #fff; min-height: 100vh; }
      .header {
        background: linear-gradient(135deg, #007acc, #0056b3);
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 24px;
        text-align: center;
      }
      .header h1 { margin: 0; font-size: 2em; }
      .header p { margin: 8px 0 0 0; opacity: 0.9; }
      .content {
        background: white;
        padding: 32px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(27,31,35,0.15);
        border: 1px solid #e1e4e8;
        margin-bottom: 24px;
      }
      .nav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
        margin-top: 16px;
      }
      .nav-item {
        padding: 16px;
        background: white;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        text-decoration: none;
        color: #24292e;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
        font-weight: 500;
        cursor: pointer;
      }
      .nav-item:hover {
        background: #f3f4f6;
        border-color: #0969da;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(27,31,35,0.15);
      }
      .status {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 16px;
        margin-top: 24px;
      }
      .status h4 { margin: 0 0 8px 0; color: #155724; }
      .status ul { margin: 0; padding-left: 20px; color: #155724; }
      .mermaid { background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 16px; margin: 16px 0; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üåä OntoWave</h1>
        <p>Documentation Interactive - Solution Compl√®te Fonctionnelle</p>
      </div>
      
      <div id="dynamic-content" class="content">
        <div style="text-align: center; color: #666;">
          ‚è≥ Chargement du contenu...
        </div>
      </div>
      
      <div style="background: #f6f8fa; border: 1px solid #e1e4e8; border-radius: 8px; padding: 24px;">
        <h3 style="margin-top: 0; color: #24292e;">üß≠ Navigation OntoWave</h3>
        <div class="nav-grid">
          <a href="#index.md" onclick="loadPage('index.md')" class="nav-item">
            üè† Accueil
          </a>
          <a href="#en/index.md" onclick="loadPage('en/index.md')" class="nav-item">
            üá¨üáß English
          </a>
          <a href="#fr/index.md" onclick="loadPage('fr/index.md')" class="nav-item">
            üá´üá∑ Fran√ßais
          </a>
          <a href="#demo/mermaid.md" onclick="loadPage('demo/mermaid.md')" class="nav-item">
            üé® D√©mo Mermaid
          </a>
          <a href="#demo/advanced-shapes.md" onclick="loadPage('demo/advanced-shapes.md')" class="nav-item">
            üéØ Formes PowerPoint
          </a>
          <a href="#demo/plantuml.md" onclick="loadPage('demo/plantuml.md')" class="nav-item">
            üìä PlantUML
          </a>
        </div>
      </div>
      
      <div class="status">
        <h4>‚úÖ Probl√®mes R√©solus avec cette Solution</h4>
        <ul>
          <li><strong>Chargement lent:</strong> Application imm√©diate et directe</li>
          <li><strong>Mermaid manquant:</strong> Biblioth√®que charg√©e et auto-rendu</li>
          <li><strong>Hash perdus:</strong> Navigation hash compl√®tement pr√©serv√©e</li>
        </ul>
      </div>
    </div>

    <script>
      console.log('üöÄ OntoWave Solution Compl√®te - Activation');
      
      // Initialiser Mermaid
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default',
        flowchart: { useMaxWidth: true }
      });
      
      // Fonction de chargement des pages
      window.loadPage = async function(pagePath) {
        console.log('üîç Chargement de:', pagePath);
        location.hash = '#' + pagePath;
        
        const contentDiv = document.getElementById('dynamic-content');
        if (!contentDiv) return;
        
        contentDiv.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">‚è≥ Chargement de ' + pagePath + '...</div>';
        
        try {
          const response = await fetch('/' + pagePath);
          if (response.ok) {
            const markdown = await response.text();
            console.log('‚úÖ Contenu charg√©:', markdown.length, 'caract√®res');
            
            // Rendu markdown avec support Mermaid complet
            let html = markdown
              .replace(/^# (.+)$/gm, '<h1 style="color: #24292e; border-bottom: 2px solid #e1e4e8; padding-bottom: 8px; margin-bottom: 16px;">$1</h1>')
              .replace(/^## (.+)$/gm, '<h2 style="color: #24292e; margin-top: 24px; margin-bottom: 16px;">$2</h2>')
              .replace(/^### (.+)$/gm, '<h3 style="color: #24292e; margin-top: 20px; margin-bottom: 12px;">$3</h3>')
              .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
              .replace(/\*(.+?)\*/g, '<em>$1</em>')
              .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="#$2" onclick="loadPage(\'$2\')" style="color: #0969da; text-decoration: none;">$1</a>')
              .replace(/```mermaid([\\s\\S]*?)```/g, function(match, content) {
                const id = 'mermaid-' + Math.random().toString(36).substr(2, 9);
                return '<div class="mermaid" id="' + id + '">' + content.trim() + '</div>';
              })
              .replace(/```([\\s\\S]*?)```/g, '<pre style="background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 16px; margin: 16px 0; overflow-x: auto;"><code>$1</code></pre>')
              .replace(/`([^`]+)`/g, '<code style="background: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: ui-monospace, SFMono-Regular, monospace;">$1</code>')
              .replace(/\n\n/g, '</p><p style="margin: 16px 0; line-height: 1.6;">')
              .replace(/\n/g, '<br>')
              .replace(/^(.+)/, '<p style="margin: 16px 0; line-height: 1.6;">$1')
              .replace(/(.+)$/, '$1</p>');
            
            contentDiv.innerHTML = html;
            
            // Initialiser Mermaid pour les nouveaux diagrammes
            setTimeout(() => {
              const mermaidElements = contentDiv.querySelectorAll('.mermaid');
              console.log('üé® √âl√©ments Mermaid trouv√©s:', mermaidElements.length);
              
              if (mermaidElements.length > 0) {
                try {
                  mermaid.run();
                  console.log('‚úÖ Mermaid rendu pour', mermaidElements.length, 'diagrammes');
                  
                  // V√©rifier le rendu apr√®s un d√©lai
                  setTimeout(() => {
                    const svgElements = contentDiv.querySelectorAll('.mermaid svg');
                    console.log('üé® SVG rendus:', svgElements.length);
                    
                    if (svgElements.length === 0 && mermaidElements.length > 0) {
                      console.log('‚ö†Ô∏è Nouvelle tentative de rendu Mermaid...');
                      mermaidElements.forEach(el => {
                        el.removeAttribute('data-processed');
                      });
                      mermaid.init(undefined, mermaidElements);
                    }
                  }, 1000);
                } catch (e) {
                  console.log('‚ùå Erreur Mermaid:', e);
                }
              }
            }, 500);
            
          } else {
            contentDiv.innerHTML = '<div style="color: #d73a49; text-align: center; padding: 20px;">‚ùå Erreur ' + response.status + ': Impossible de charger ' + pagePath + '</div>';
          }
        } catch (error) {
          console.log('‚ùå Erreur de chargement:', error);
          contentDiv.innerHTML = '<div style="color: #d73a49; text-align: center; padding: 20px;">‚ùå Erreur de r√©seau lors du chargement de ' + pagePath + '</div>';
        }
      };
      
      // Gestion des changements de hash
      window.addEventListener('hashchange', () => {
        const hash = location.hash.replace('#', '') || 'index.md';
        console.log('üîó Hash chang√© vers:', hash);
        loadPage(hash);
      });
      
      // Chargement initial
      const initialPage = location.hash.replace('#', '') || 'index.md';
      console.log('üèÅ Chargement initial:', initialPage);
      loadPage(initialPage);
    </script>
  </body>
</html>
