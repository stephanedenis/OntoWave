<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OntoWave - GÃ©nÃ©rateur de diagrammes pour sites statiques</title>
    
    <!-- Styles pour navigation multilingue -->
    <style>
    .lang-toggle {
        position: fixed;
        top: 120px;
        left: 20px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 8px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        border: 1px solid #e1e4e8;
        cursor: default; /* Curseur normal, pas de dÃ©placement */
        user-select: none; /* Pas de sÃ©lection de texte */
    }

    .lang-toggle button {
        padding: 6px 10px;
        border: 1px solid #d0d7de;
        border-radius: 16px;
        background: white;
        cursor: pointer;
        font-size: 0.75em;
        min-width: 80px;
        text-align: center;
        transition: all 0.2s ease;
        white-space: nowrap;
        pointer-events: auto; /* S'assurer que les Ã©vÃ©nements fonctionnent */
    }

    .lang-toggle button:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
    }

    .lang-toggle button.active {
        background: #0969da;
        color: white;
        border-color: #0969da;
    }

    .lang-content {
        transition: opacity 0.3s ease;
    }
    
    .lang-content.hidden {
        display: none !important;
    }
    
    .lang-content.visible {
        display: block !important;
    }
    </style>
</head>
<body>
    <!-- OntoWave chargera automatiquement index.md -->
    <script src="ontowave.min.js"></script>
    
    <!-- Script multilingue -->
    <script>
    // Attendre que OntoWave ait fini de charger le contenu
    document.addEventListener('DOMContentLoaded', function() {
        // Attendre que OntoWave charge complÃ¨tement avant d'initialiser le multilingue
        setTimeout(initializeMultilang, 3000); // AugmentÃ© Ã  3 secondes
    });
    
    // Observer OntoWave pour dÃ©tecter quand il est prÃªt
    function waitForOntoWave() {
        if (window.OntoWave && window.OntoWave.instance) {
            console.log('âœ… OntoWave dÃ©tectÃ©, initialisation multilingue');
            setTimeout(initializeMultilang, 500);
        } else {
            console.log('â³ Attente OntoWave...');
            setTimeout(waitForOntoWave, 1000);
        }
    }
    
    // DÃ©marrer l'attente d'OntoWave en parallÃ¨le
    setTimeout(waitForOntoWave, 1000);
    
    function initializeMultilang() {
        console.log('ðŸŒ Initialisation du systÃ¨me multilingue');
        
        // VÃ©rifier que les Ã©lÃ©ments sont prÃ©sents
        const frDiv = document.getElementById('lang-fr');
        const enDiv = document.getElementById('lang-en');
        
        if (!frDiv || !enDiv) {
            console.log('âŒ Ã‰lÃ©ments de langue non trouvÃ©s, retry dans 1s');
            setTimeout(initializeMultilang, 1000);
            return;
        }
        
        console.log('âœ… Ã‰lÃ©ments de langue trouvÃ©s');
        
        // Masquer tous les contenus par dÃ©faut
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // CrÃ©er les boutons de navigation s'ils n'existent pas
        let langToggle = document.querySelector('.lang-toggle');
        if (!langToggle) {
            langToggle = document.createElement('div');
            langToggle.className = 'lang-toggle';
            langToggle.innerHTML = `
                <button onclick="toggleLang('fr')" id="btn-fr">ðŸ‡«ðŸ‡· FR</button>
                <button onclick="toggleLang('en')" id="btn-en">ðŸ‡¬ðŸ‡§ EN</button>
            `;
            document.body.appendChild(langToggle);
            console.log('âœ… Boutons de langue crÃ©Ã©s');
            
            // Ajouter des Ã©vÃ©nements de secours au cas oÃ¹ onclick ne fonctionne pas
            document.getElementById('btn-fr').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('ðŸ”§ Event listener FR dÃ©clenchÃ©');
                toggleLang('fr');
            });
            
            document.getElementById('btn-en').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('ðŸ”§ Event listener EN dÃ©clenchÃ©');
                toggleLang('en');
            });
            
            console.log('âœ… Event listeners de secours ajoutÃ©s');
        }
        
        // Initialiser la langue
        const savedLang = localStorage.getItem('ontowave-lang') || detectLanguage();
        
        // Configurer OntoWave pour la langue
        if (window.OntoWave && window.OntoWave.config) {
            console.log('âš™ï¸ Configuration OntoWave pour langue:', savedLang);
            window.OntoWave.config.i18n = { 
                default: savedLang, 
                lang: savedLang,
                supported: ['fr', 'en']
            };
            window.OntoWave.config.ui = window.OntoWave.config.ui || {};
            window.OntoWave.config.ui.lang = savedLang;
        }
        
        toggleLang(savedLang);
        
        // Observer les changements DOM pour mettre Ã  jour les nouveaux Ã©lÃ©ments OntoWave
        const observer = new MutationObserver(function(mutations) {
            let shouldUpdate = false;
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (
                        node.classList?.contains('ontowave-menu-option') ||
                        node.querySelector?.('.ontowave-menu-option') ||
                        node.classList?.contains('ontowave-floating-menu')
                    )) {
                        shouldUpdate = true;
                    }
                });
            });
            if (shouldUpdate) {
                console.log('ðŸ”„ Nouveaux Ã©lÃ©ments OntoWave dÃ©tectÃ©s, mise Ã  jour des textes');
                const currentLang = localStorage.getItem('ontowave-lang') || 'fr';
                updateOntoWaveTexts(currentLang);
            }
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        console.log('ðŸ‘ï¸ Observer DOM installÃ© pour les mises Ã  jour multilingues');
        
        // Forcer Prism Ã  recolorer aprÃ¨s le chargement du contenu
        if (window.Prism && window.Prism.highlightAll) {
            try {
                console.log('ðŸŽ¨ Recoloration Prism forcÃ©e');
                window.Prism.highlightAll();
            } catch (error) {
                console.warn('âš ï¸ Erreur Prism initiale:', error.message);
            }
        }
        
        // Recolorer encore aprÃ¨s un dÃ©lai au cas oÃ¹ le contenu se charge tardivement
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                try {
                    console.log('ðŸŽ¨ Recoloration Prism diffÃ©rÃ©e');
                    window.Prism.highlightAll();
                } catch (error) {
                    console.warn('âš ï¸ Erreur Prism diffÃ©rÃ©e:', error.message);
                }
            }
        }, 1000);
    }

    // DÃ©tection automatique de la langue du navigateur
    function detectLanguage() {
        const userLang = navigator.language || navigator.userLanguage;
        return userLang.startsWith('fr') ? 'fr' : 'en';
    }
    
    // Mise Ã  jour des textes OntoWave selon la langue
    function updateOntoWaveTexts(lang) {
        console.log('ðŸŒ Mise Ã  jour textes OntoWave:', lang);
        
        // D'abord appeler la mÃ©thode native OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('ðŸ”„ Appel updateInterfaceTexts() OntoWave avec locale:', lang);
            window.OntoWave.instance.updateInterfaceTexts(lang);
            return; // La mÃ©thode OntoWave gÃ¨re tout
        }
        
        // Retry avec dÃ©lai si OntoWave n'est pas encore prÃªt
        setTimeout(() => {
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('ðŸ”„ Appel diffÃ©rÃ© updateInterfaceTexts() OntoWave avec locale:', lang);
                window.OntoWave.instance.updateInterfaceTexts(lang);
                return;
            }
            console.log('âš ï¸ OntoWave.updateInterfaceTexts() non disponible, utilisation du fallback');
        }, 200);
        
        // Fallback manuel pour compatibilitÃ©
        const texts = {
            fr: {
                configuration: 'Configuration',
                accueil: 'Accueil',
                galerie: 'Galerie',
                theme: 'ThÃ¨me', 
                search: 'Rechercher',
                menu: 'Menu',
                close: 'Fermer',
                copy: 'Copier',
                fullscreen: 'Plein Ã©cran',
                download: 'TÃ©lÃ©charger',
                print: 'Imprimer',
                home: 'Accueil'
            },
            en: {
                configuration: 'Configuration',
                accueil: 'Home',
                galerie: 'Gallery', 
                theme: 'Theme',
                search: 'Search', 
                menu: 'Menu',
                close: 'Close',
                copy: 'Copy',
                fullscreen: 'Fullscreen',
                download: 'Download',
                print: 'Print',
                home: 'Home'
            }
        };
        
        const currentTexts = texts[lang] || texts.en;
        
        // Mettre Ã  jour les Ã©lÃ©ments du menu OntoWave spÃ©cifiquement
        setTimeout(() => {
            // Menu flottant OntoWave - Configuration
            const configOption = document.querySelector('.ontowave-menu-option[onclick*="toggleConfigurationPanel"]');
            if (configOption) {
                configOption.innerHTML = 'âš™ï¸ ' + currentTexts.configuration;
                console.log('âœ… Bouton Configuration mis Ã  jour:', currentTexts.configuration);
            }
            
            // Menu flottant OntoWave - Accueil
            const homeOption = document.querySelector('.ontowave-menu-option[onclick*="loadPage"]');
            if (homeOption) {
                homeOption.innerHTML = 'ðŸ  ' + currentTexts.home;
                console.log('âœ… Bouton Accueil mis Ã  jour:', currentTexts.home);
            }
            
            // Menu flottant OntoWave - Galerie (si prÃ©sente)
            const galleryOption = document.querySelector('.ontowave-menu-option[onclick*="gallery"]');
            if (galleryOption) {
                galleryOption.innerHTML = 'ðŸŽ¨ ' + currentTexts.galerie;
                console.log('âœ… Bouton Galerie mis Ã  jour:', currentTexts.galerie);
            }
            
            // Autres Ã©lÃ©ments gÃ©nÃ©riques par titre/aria-label
            const elements = document.querySelectorAll('[title], [aria-label]');
            elements.forEach(el => {
                const title = el.getAttribute('title');
                const ariaLabel = el.getAttribute('aria-label');
                
                // Mapper les textes anglais vers la langue courante
                Object.keys(currentTexts).forEach(key => {
                    if (title && title.toLowerCase().includes(key)) {
                        el.setAttribute('title', currentTexts[key]);
                    }
                    if (ariaLabel && ariaLabel.toLowerCase().includes(key)) {
                        el.setAttribute('aria-label', currentTexts[key]);
                    }
                });
            });
            
            console.log('âœ… Textes OntoWave mis Ã  jour pour', lang);
        }, 200);
    }

    // Fonction pour changer de langue
    function toggleLang(lang) {
        console.log('ðŸ”„ toggleLang appelÃ© avec:', lang);
        
        // SÃ©curitÃ© : Reset l'Ã©tat de drag au changement de langue
        if (window.resetOntoWaveDragState) {
            window.resetOntoWaveDragState();
        }
        
        // Test de diagnostic
        console.log('ðŸ§ª Ã‰tat avant changement:', {
            'lang-fr': document.getElementById('lang-fr')?.style.display,
            'lang-en': document.getElementById('lang-en')?.style.display
        });
        
        // Masquer tous les contenus
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // Afficher le contenu de la langue sÃ©lectionnÃ©e
        const targetContent = document.getElementById('lang-' + lang);
        if (targetContent) {
            targetContent.classList.remove('hidden');
            targetContent.classList.add('visible');
            console.log('âœ… Contenu affichÃ© pour:', lang);
        } else {
            console.error('âŒ Ã‰lÃ©ment lang-' + lang + ' non trouvÃ©');
        }
        
        // Mettre Ã  jour les boutons
        document.querySelectorAll('.lang-toggle button').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeLangBtn = document.getElementById('btn-' + lang);
        if (activeLangBtn) {
            activeLangBtn.classList.add('active');
            console.log('âœ… Bouton activÃ©:', lang);
        }
        
        // Sauvegarder la prÃ©fÃ©rence
        localStorage.setItem('ontowave-lang', lang);
        
        // Mettre Ã  jour les textes de l'interface OntoWave
        updateOntoWaveTexts(lang);
        
        // Test pour voir si les boutons rÃ©pondent
        console.log('ðŸ”§ TEST: Bouton cliquÃ©, lang =', lang);
        
        // Appeler la mÃ©thode de mise Ã  jour de l'interface OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('ðŸ”„ Mise Ã  jour interface OntoWave avec mÃ©thode intÃ©grÃ©e');
            window.OntoWave.instance.updateInterfaceTexts();
        } else {
            console.log('âš ï¸ OntoWave.instance ou updateInterfaceTexts non disponible', {
                OntoWave: !!window.OntoWave,
                instance: !!(window.OntoWave && window.OntoWave.instance),
                method: !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts)
            });
        }
        
        // Mettre Ã  jour les boutons
        document.querySelectorAll('.lang-toggle button').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeBtn = document.getElementById('btn-' + lang);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
        
        // Sauvegarder la prÃ©fÃ©rence
        localStorage.setItem('ontowave-lang', lang);
        
        // Mettre Ã  jour les textes de l'interface OntoWave
        updateOntoWaveTexts(lang);
        
        // Appeler la mÃ©thode de mise Ã  jour de l'interface OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('ðŸ”„ Mise Ã  jour interface OntoWave avec mÃ©thode intÃ©grÃ©e');
            window.OntoWave.instance.updateInterfaceTexts();
        } else {
            console.log('âš ï¸ OntoWave.instance ou updateInterfaceTexts non disponible', {
                OntoWave: !!window.OntoWave,
                instance: !!(window.OntoWave && window.OntoWave.instance),
                method: !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts)
            });
        }
        
        // Forcer la mise Ã  jour des menus OntoWave aprÃ¨s un dÃ©lai supplÃ©mentaire
        setTimeout(() => {
            updateOntoWaveTexts(lang);
            // Appeler aussi la mÃ©thode interne OntoWave
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('ðŸ”„ (300ms) Mise Ã  jour OntoWave.instance');
                window.OntoWave.instance.updateInterfaceTexts();
            } else {
                console.log('âš ï¸ (300ms) OntoWave.instance non disponible');
            }
        }, 300);
        
        setTimeout(() => {
            updateOntoWaveTexts(lang);
            // Appeler aussi la mÃ©thode interne OntoWave
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('ðŸ”„ (800ms) Mise Ã  jour OntoWave.instance');
                window.OntoWave.instance.updateInterfaceTexts();
            } else {
                console.log('âš ï¸ (800ms) OntoWave.instance non disponible');
            }
        }, 800);
        
        // Forcer plusieurs recolorations Prism (le problÃ¨me principal)
        console.log('ðŸŽ¨ Recoloration Prism immÃ©diate');
        try {
            if (window.Prism && window.Prism.highlightAll) {
                window.Prism.highlightAll();
            }
        } catch (error) {
            console.warn('âš ï¸ Erreur Prism immÃ©diate:', error.message);
        }
        
        // Recoloration diffÃ©rÃ©e pour s'assurer que Ã§a marche
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('ðŸŽ¨ Recoloration Prism diffÃ©rÃ©e 1');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('âš ï¸ Erreur Prism diffÃ©rÃ©e 1:', error.message);
            }
        }, 100);
        
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('ðŸŽ¨ Recoloration Prism diffÃ©rÃ©e 2');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('âš ï¸ Erreur Prism diffÃ©rÃ©e 2:', error.message);
            }
        }, 500);
        
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('ðŸŽ¨ Recoloration Prism diffÃ©rÃ©e 3');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('âš ï¸ Erreur Prism diffÃ©rÃ©e 3:', error.message);
            }
        }, 1000);
    }
    
    // Fonction de test globale accessible depuis la console
    window.testMultilang = function() {
        console.log('ðŸ§ª TEST MULTILINGUE MANUEL');
        console.log('OntoWave disponible:', !!window.OntoWave);
        console.log('OntoWave.instance disponible:', !!(window.OntoWave && window.OntoWave.instance));
        console.log('updateInterfaceTexts disponible:', !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts));
        
        console.log('Ã‰lÃ©ments DOM:');
        console.log('- lang-fr:', !!document.getElementById('lang-fr'));
        console.log('- lang-en:', !!document.getElementById('lang-en'));
        console.log('- btn-fr:', !!document.getElementById('btn-fr'));
        console.log('- btn-en:', !!document.getElementById('btn-en'));
        
        console.log('Test changement FR...');
        toggleLang('fr');
        
        setTimeout(() => {
            console.log('Test changement EN...');
            toggleLang('en');
        }, 1000);
    };
    
    console.log('ðŸ”§ Fonction testMultilang() disponible dans la console');
    </script>
</body>
</html>
