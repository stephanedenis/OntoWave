<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OntoWave - G√©n√©rateur de diagrammes pour sites statiques</title>
    
    <!-- Styles pour navigation multilingue -->
    <style>
    .lang-toggle {
        position: fixed;
        top: 120px;
        left: 20px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 8px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        border: 1px solid #e1e4e8;
        cursor: default; /* Curseur normal, pas de d√©placement */
        user-select: none; /* Pas de s√©lection de texte */
    }

    .lang-toggle button {
        padding: 6px 10px;
        border: 1px solid #d0d7de;
        border-radius: 16px;
        background: white;
        cursor: pointer;
        font-size: 0.75em;
        min-width: 80px;
        text-align: center;
        transition: all 0.2s ease;
        white-space: nowrap;
        pointer-events: auto; /* S'assurer que les √©v√©nements fonctionnent */
    }

    .lang-toggle button:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
    }

    .lang-toggle button.active {
        background: #0969da;
        color: white;
        border-color: #0969da;
    }

    .lang-content {
        transition: opacity 0.3s ease;
    }
    
    .lang-content.hidden {
        display: none !important;
    }
    
    .lang-content.visible {
        display: block !important;
    }
    </style>
</head>
<body>
    <!-- OntoWave chargera automatiquement index.md -->
    <script src="ontowave.min.js"></script>
    
    <!-- Script multilingue -->
    <script>
    // Attendre que OntoWave ait fini de charger le contenu
    document.addEventListener('DOMContentLoaded', function() {
        // Attendre que OntoWave charge compl√®tement avant d'initialiser le multilingue
        setTimeout(initializeMultilang, 3000); // Augment√© √† 3 secondes
    });
    
    // Observer OntoWave pour d√©tecter quand il est pr√™t
    function waitForOntoWave() {
        if (window.OntoWave && window.OntoWave.instance) {
            console.log('‚úÖ OntoWave d√©tect√©, initialisation multilingue');
            setTimeout(initializeMultilang, 500);
        } else {
            console.log('‚è≥ Attente OntoWave...');
            setTimeout(waitForOntoWave, 1000);
        }
    }
    
    // D√©marrer l'attente d'OntoWave en parall√®le
    setTimeout(waitForOntoWave, 1000);
    
    function initializeMultilang() {
        console.log('üåê Initialisation du syst√®me multilingue');
        
        // V√©rifier que les √©l√©ments sont pr√©sents
        const frDiv = document.getElementById('lang-fr');
        const enDiv = document.getElementById('lang-en');
        
        if (!frDiv || !enDiv) {
            console.log('‚ùå √âl√©ments de langue non trouv√©s, retry dans 1s');
            setTimeout(initializeMultilang, 1000);
            return;
        }
        
        console.log('‚úÖ √âl√©ments de langue trouv√©s');
        
        // Masquer tous les contenus par d√©faut
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // Cr√©er les boutons de navigation s'ils n'existent pas
        let langToggle = document.querySelector('.lang-toggle');
        if (!langToggle) {
            langToggle = document.createElement('div');
            langToggle.className = 'lang-toggle';
            langToggle.innerHTML = `
                <button onclick="toggleLang('fr')" id="btn-fr">üá´üá∑ FR</button>
                <button onclick="toggleLang('en')" id="btn-en">üá¨üáß EN</button>
            `;
            document.body.appendChild(langToggle);
            console.log('‚úÖ Boutons de langue cr√©√©s');
            
            // Ajouter des √©v√©nements de secours au cas o√π onclick ne fonctionne pas
            document.getElementById('btn-fr').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üîß Event listener FR d√©clench√©');
                toggleLang('fr');
            });
            
            document.getElementById('btn-en').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üîß Event listener EN d√©clench√©');
                toggleLang('en');
            });
            
            console.log('‚úÖ Event listeners de secours ajout√©s');
        }
        
        // Initialiser la langue
        const savedLang = localStorage.getItem('ontowave-lang') || detectLanguage();
        
        // Configurer OntoWave pour la langue
        if (window.OntoWave && window.OntoWave.config) {
            console.log('‚öôÔ∏è Configuration OntoWave pour langue:', savedLang);
            window.OntoWave.config.i18n = { 
                default: savedLang, 
                lang: savedLang,
                supported: ['fr', 'en']
            };
            window.OntoWave.config.ui = window.OntoWave.config.ui || {};
            window.OntoWave.config.ui.lang = savedLang;
        }
        
        toggleLang(savedLang);
        
        // Observer les changements DOM pour mettre √† jour les nouveaux √©l√©ments OntoWave
        const observer = new MutationObserver(function(mutations) {
            let shouldUpdate = false;
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (
                        node.classList?.contains('ontowave-menu-option') ||
                        node.querySelector?.('.ontowave-menu-option') ||
                        node.classList?.contains('ontowave-floating-menu')
                    )) {
                        shouldUpdate = true;
                    }
                });
            });
            if (shouldUpdate) {
                console.log('üîÑ Nouveaux √©l√©ments OntoWave d√©tect√©s, mise √† jour des textes');
                const currentLang = localStorage.getItem('ontowave-lang') || 'fr';
                updateOntoWaveTexts(currentLang);
            }
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        console.log('üëÅÔ∏è Observer DOM install√© pour les mises √† jour multilingues');
        
        // Forcer Prism √† recolorer apr√®s le chargement du contenu
        if (window.Prism && window.Prism.highlightAll) {
            try {
                console.log('üé® Recoloration Prism forc√©e');
                window.Prism.highlightAll();
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur Prism initiale:', error.message);
            }
        }
        
        // Recolorer encore apr√®s un d√©lai au cas o√π le contenu se charge tardivement
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                try {
                    console.log('üé® Recoloration Prism diff√©r√©e');
                    window.Prism.highlightAll();
                } catch (error) {
                    console.warn('‚ö†Ô∏è Erreur Prism diff√©r√©e:', error.message);
                }
            }
        }, 1000);
    }

    // D√©tection automatique de la langue du navigateur
    function detectLanguage() {
        const userLang = navigator.language || navigator.userLanguage;
        return userLang.startsWith('fr') ? 'fr' : 'en';
    }
    
    // Mise √† jour des textes OntoWave selon la langue
    function updateOntoWaveTexts(lang) {
        console.log('üåê Mise √† jour textes OntoWave:', lang);
        
        // D'abord appeler la m√©thode native OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('üîÑ Appel updateInterfaceTexts() OntoWave avec locale:', lang);
            window.OntoWave.instance.updateInterfaceTexts(lang);
            return; // La m√©thode OntoWave g√®re tout
        }
        
        // Retry avec d√©lai si OntoWave n'est pas encore pr√™t
        setTimeout(() => {
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('üîÑ Appel diff√©r√© updateInterfaceTexts() OntoWave avec locale:', lang);
                window.OntoWave.instance.updateInterfaceTexts(lang);
                return;
            }
            console.log('‚ö†Ô∏è OntoWave.updateInterfaceTexts() non disponible, utilisation du fallback');
        }, 200);
        
        // Fallback manuel pour compatibilit√©
        const texts = {
            fr: {
                configuration: 'Configuration',
                accueil: 'Accueil',
                galerie: 'Galerie',
                theme: 'Th√®me', 
                search: 'Rechercher',
                menu: 'Menu',
                close: 'Fermer',
                copy: 'Copier',
                fullscreen: 'Plein √©cran',
                download: 'T√©l√©charger',
                print: 'Imprimer',
                home: 'Accueil'
            },
            en: {
                configuration: 'Configuration',
                accueil: 'Home',
                galerie: 'Gallery', 
                theme: 'Theme',
                search: 'Search', 
                menu: 'Menu',
                close: 'Close',
                copy: 'Copy',
                fullscreen: 'Fullscreen',
                download: 'Download',
                print: 'Print',
                home: 'Home'
            }
        };
        
        const currentTexts = texts[lang] || texts.en;
        
        // Mettre √† jour les √©l√©ments du menu OntoWave sp√©cifiquement
        setTimeout(() => {
            // Menu flottant OntoWave - Configuration
            const configOption = document.querySelector('.ontowave-menu-option[onclick*="toggleConfigurationPanel"]');
            if (configOption) {
                configOption.innerHTML = '‚öôÔ∏è ' + currentTexts.configuration;
                console.log('‚úÖ Bouton Configuration mis √† jour:', currentTexts.configuration);
            }
            
            // Menu flottant OntoWave - Accueil
            const homeOption = document.querySelector('.ontowave-menu-option[onclick*="loadPage"]');
            if (homeOption) {
                homeOption.innerHTML = 'üè† ' + currentTexts.home;
                console.log('‚úÖ Bouton Accueil mis √† jour:', currentTexts.home);
            }
            
            // Menu flottant OntoWave - Galerie (si pr√©sente)
            const galleryOption = document.querySelector('.ontowave-menu-option[onclick*="gallery"]');
            if (galleryOption) {
                galleryOption.innerHTML = 'üé® ' + currentTexts.galerie;
                console.log('‚úÖ Bouton Galerie mis √† jour:', currentTexts.galerie);
            }
            
            // Autres √©l√©ments g√©n√©riques par titre/aria-label
            const elements = document.querySelectorAll('[title], [aria-label]');
            elements.forEach(el => {
                const title = el.getAttribute('title');
                const ariaLabel = el.getAttribute('aria-label');
                
                // Mapper les textes anglais vers la langue courante
                Object.keys(currentTexts).forEach(key => {
                    if (title && title.toLowerCase().includes(key)) {
                        el.setAttribute('title', currentTexts[key]);
                    }
                    if (ariaLabel && ariaLabel.toLowerCase().includes(key)) {
                        el.setAttribute('aria-label', currentTexts[key]);
                    }
                });
            });
            
            console.log('‚úÖ Textes OntoWave mis √† jour pour', lang);
        }, 200);
    }

    // Fonction pour changer de langue
    function toggleLang(lang) {
        console.log('üîÑ toggleLang appel√© avec:', lang);
        
        // S√©curit√© : Reset l'√©tat de drag au changement de langue
        if (window.resetOntoWaveDragState) {
            window.resetOntoWaveDragState();
        }
        
        // Test de diagnostic
        console.log('üß™ √âtat avant changement:', {
            'lang-fr': document.getElementById('lang-fr')?.style.display,
            'lang-en': document.getElementById('lang-en')?.style.display
        });
        
        // Masquer tous les contenus
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // Afficher le contenu de la langue s√©lectionn√©e
        const targetContent = document.getElementById('lang-' + lang);
        if (targetContent) {
            targetContent.classList.remove('hidden');
            targetContent.classList.add('visible');
            console.log('‚úÖ Contenu affich√© pour:', lang);
        } else {
            console.error('‚ùå √âl√©ment lang-' + lang + ' non trouv√©');
        }
        
        // Mettre √† jour les boutons
        document.querySelectorAll('.lang-toggle button').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeLangBtn = document.getElementById('btn-' + lang);
        if (activeLangBtn) {
            activeLangBtn.classList.add('active');
            console.log('‚úÖ Bouton activ√©:', lang);
        }
        
        // Sauvegarder la pr√©f√©rence
        localStorage.setItem('ontowave-lang', lang);
        
        // Mettre √† jour les textes de l'interface OntoWave
        updateOntoWaveTexts(lang);
        
        // Test pour voir si les boutons r√©pondent
        console.log('üîß TEST: Bouton cliqu√©, lang =', lang);
        
        // Appeler la m√©thode de mise √† jour de l'interface OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('üîÑ Mise √† jour interface OntoWave avec m√©thode int√©gr√©e');
            window.OntoWave.instance.updateInterfaceTexts();
        } else {
            console.log('‚ö†Ô∏è OntoWave.instance ou updateInterfaceTexts non disponible', {
                OntoWave: !!window.OntoWave,
                instance: !!(window.OntoWave && window.OntoWave.instance),
                method: !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts)
            });
        }
        
        // Mettre √† jour les boutons
        document.querySelectorAll('.lang-toggle button').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeBtn = document.getElementById('btn-' + lang);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
        
        // Sauvegarder la pr√©f√©rence
        localStorage.setItem('ontowave-lang', lang);
        
        // Mettre √† jour les textes de l'interface OntoWave
        updateOntoWaveTexts(lang);
        
        // Appeler la m√©thode de mise √† jour de l'interface OntoWave si disponible
        if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
            console.log('üîÑ Mise √† jour interface OntoWave avec m√©thode int√©gr√©e');
            window.OntoWave.instance.updateInterfaceTexts();
        } else {
            console.log('‚ö†Ô∏è OntoWave.instance ou updateInterfaceTexts non disponible', {
                OntoWave: !!window.OntoWave,
                instance: !!(window.OntoWave && window.OntoWave.instance),
                method: !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts)
            });
        }
        
        // Forcer la mise √† jour des menus OntoWave apr√®s un d√©lai suppl√©mentaire
        setTimeout(() => {
            updateOntoWaveTexts(lang);
            // Appeler aussi la m√©thode interne OntoWave
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('üîÑ (300ms) Mise √† jour OntoWave.instance');
                window.OntoWave.instance.updateInterfaceTexts();
            } else {
                console.log('‚ö†Ô∏è (300ms) OntoWave.instance non disponible');
            }
        }, 300);
        
        setTimeout(() => {
            updateOntoWaveTexts(lang);
            // Appeler aussi la m√©thode interne OntoWave
            if (window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts) {
                console.log('üîÑ (800ms) Mise √† jour OntoWave.instance');
                window.OntoWave.instance.updateInterfaceTexts();
            } else {
                console.log('‚ö†Ô∏è (800ms) OntoWave.instance non disponible');
            }
        }, 800);
        
        // Forcer plusieurs recolorations Prism (le probl√®me principal)
        console.log('üé® Recoloration Prism imm√©diate');
        try {
            if (window.Prism && window.Prism.highlightAll) {
                window.Prism.highlightAll();
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Erreur Prism imm√©diate:', error.message);
        }
        
        // Recoloration diff√©r√©e pour s'assurer que √ßa marche
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('üé® Recoloration Prism diff√©r√©e 1');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur Prism diff√©r√©e 1:', error.message);
            }
        }, 100);
        
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('üé® Recoloration Prism diff√©r√©e 2');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur Prism diff√©r√©e 2:', error.message);
            }
        }, 500);
        
        setTimeout(() => {
            try {
                if (window.Prism && window.Prism.highlightAll) {
                    console.log('üé® Recoloration Prism diff√©r√©e 3');
                    window.Prism.highlightAll();
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur Prism diff√©r√©e 3:', error.message);
            }
        }, 1000);
    }
    
    // Fonction de test globale accessible depuis la console
    window.testMultilang = function() {
        console.log('üß™ TEST MULTILINGUE MANUEL');
        console.log('OntoWave disponible:', !!window.OntoWave);
        console.log('OntoWave.instance disponible:', !!(window.OntoWave && window.OntoWave.instance));
        console.log('updateInterfaceTexts disponible:', !!(window.OntoWave && window.OntoWave.instance && window.OntoWave.instance.updateInterfaceTexts));
        
        console.log('√âl√©ments DOM:');
        console.log('- lang-fr:', !!document.getElementById('lang-fr'));
        console.log('- lang-en:', !!document.getElementById('lang-en'));
        console.log('- btn-fr:', !!document.getElementById('btn-fr'));
        console.log('- btn-en:', !!document.getElementById('btn-en'));
        
        console.log('Test changement FR...');
        toggleLang('fr');
        
        setTimeout(() => {
            console.log('Test changement EN...');
            toggleLang('en');
        }, 1000);
    };
    
    console.log('üîß Fonction testMultilang() disponible dans la console');
    </script>
</body>
</html>
