<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OntoWave - Générateur de diagrammes pour sites statiques</title>
    
    <!-- Styles pour navigation multilingue -->
    <style>
    .lang-toggle {
        position: fixed;
        top: 120px;
        left: 20px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 8px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        border: 1px solid #e1e4e8;
    }

    .lang-toggle button {
        padding: 6px 10px;
        border: 1px solid #d0d7de;
        border-radius: 16px;
        background: white;
        cursor: pointer;
        font-size: 0.75em;
        min-width: 80px;
        text-align: center;
        transition: all 0.2s ease;
        white-space: nowrap;
    }

    .lang-toggle button:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
    }

    .lang-toggle button.active {
        background: #0969da;
        color: white;
        border-color: #0969da;
    }

    .lang-content {
        transition: opacity 0.3s ease;
    }
    
    .lang-content.hidden {
        display: none !important;
    }
    
    .lang-content.visible {
        display: block !important;
    }
    </style>
</head>
<body>
    <!-- OntoWave chargera automatiquement index.md -->
    <script src="ontowave.min.js"></script>
    
    <!-- Script multilingue -->
    <script>
    // Attendre que OntoWave ait fini de charger le contenu
    document.addEventListener('DOMContentLoaded', function() {
        // Attendre un peu plus pour que OntoWave termine
        setTimeout(initializeMultilang, 2000);
    });
    
    function initializeMultilang() {
        console.log('🌐 Initialisation du système multilingue');
        
        // Vérifier que les éléments sont présents
        const frDiv = document.getElementById('lang-fr');
        const enDiv = document.getElementById('lang-en');
        
        if (!frDiv || !enDiv) {
            console.log('❌ Éléments de langue non trouvés, retry dans 1s');
            setTimeout(initializeMultilang, 1000);
            return;
        }
        
        console.log('✅ Éléments de langue trouvés');
        
        // Masquer tous les contenus par défaut
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // Créer les boutons de navigation s'ils n'existent pas
        let langToggle = document.querySelector('.lang-toggle');
        if (!langToggle) {
            langToggle = document.createElement('div');
            langToggle.className = 'lang-toggle';
            langToggle.innerHTML = `
                <button onclick="toggleLang('fr')" id="btn-fr">🇫🇷 FR</button>
                <button onclick="toggleLang('en')" id="btn-en">🇬🇧 EN</button>
            `;
            document.body.appendChild(langToggle);
            console.log('✅ Boutons de langue créés');
        }
        
        // Initialiser la langue
        const savedLang = localStorage.getItem('ontowave-lang') || detectLanguage();
        
        // Configurer OntoWave pour la langue
        if (window.OntoWave && window.OntoWave.config) {
            console.log('⚙️ Configuration OntoWave pour langue:', savedLang);
            window.OntoWave.config.i18n = { 
                default: savedLang, 
                lang: savedLang,
                supported: ['fr', 'en']
            };
            window.OntoWave.config.ui = window.OntoWave.config.ui || {};
            window.OntoWave.config.ui.lang = savedLang;
        }
        
        toggleLang(savedLang);
        
        // Observer les changements DOM pour mettre à jour les nouveaux éléments OntoWave
        const observer = new MutationObserver(function(mutations) {
            let shouldUpdate = false;
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (
                        node.classList?.contains('ontowave-menu-option') ||
                        node.querySelector?.('.ontowave-menu-option') ||
                        node.classList?.contains('ontowave-floating-menu')
                    )) {
                        shouldUpdate = true;
                    }
                });
            });
            if (shouldUpdate) {
                console.log('🔄 Nouveaux éléments OntoWave détectés, mise à jour des textes');
                const currentLang = localStorage.getItem('ontowave-lang') || 'fr';
                updateOntoWaveTexts(currentLang);
            }
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        console.log('👁️ Observer DOM installé pour les mises à jour multilingues');
        
        // Forcer Prism à recolorer après le chargement du contenu
        if (window.Prism && window.Prism.highlightAll) {
            console.log('🎨 Recoloration Prism forcée');
            window.Prism.highlightAll();
        }
        
        // Recolorer encore après un délai au cas où le contenu se charge tardivement
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                console.log('🎨 Recoloration Prism différée');
                window.Prism.highlightAll();
            }
        }, 1000);
    }

    // Détection automatique de la langue du navigateur
    function detectLanguage() {
        const userLang = navigator.language || navigator.userLanguage;
        return userLang.startsWith('fr') ? 'fr' : 'en';
    }
    
    // Mise à jour des textes OntoWave selon la langue
    function updateOntoWaveTexts(lang) {
        console.log('🌐 Mise à jour textes OntoWave:', lang);
        
        const texts = {
            fr: {
                configuration: 'Configuration',
                accueil: 'Accueil',
                galerie: 'Galerie',
                theme: 'Thème', 
                search: 'Rechercher',
                menu: 'Menu',
                close: 'Fermer',
                copy: 'Copier',
                fullscreen: 'Plein écran',
                download: 'Télécharger',
                print: 'Imprimer',
                home: 'Accueil'
            },
            en: {
                configuration: 'Configuration',
                accueil: 'Home',
                galerie: 'Gallery', 
                theme: 'Theme',
                search: 'Search', 
                menu: 'Menu',
                close: 'Close',
                copy: 'Copy',
                fullscreen: 'Fullscreen',
                download: 'Download',
                print: 'Print',
                home: 'Home'
            }
        };
        
        const currentTexts = texts[lang] || texts.en;
        
        // Mettre à jour les éléments du menu OntoWave spécifiquement
        setTimeout(() => {
            // Menu flottant OntoWave - Configuration
            const configOption = document.querySelector('.ontowave-menu-option[onclick*="toggleConfigurationPanel"]');
            if (configOption) {
                configOption.innerHTML = '⚙️ ' + currentTexts.configuration;
                console.log('✅ Bouton Configuration mis à jour:', currentTexts.configuration);
            }
            
            // Menu flottant OntoWave - Accueil
            const homeOption = document.querySelector('.ontowave-menu-option[onclick*="loadPage"]');
            if (homeOption) {
                homeOption.innerHTML = '🏠 ' + currentTexts.home;
                console.log('✅ Bouton Accueil mis à jour:', currentTexts.home);
            }
            
            // Menu flottant OntoWave - Galerie (si présente)
            const galleryOption = document.querySelector('.ontowave-menu-option[onclick*="gallery"]');
            if (galleryOption) {
                galleryOption.innerHTML = '🎨 ' + currentTexts.galerie;
                console.log('✅ Bouton Galerie mis à jour:', currentTexts.galerie);
            }
            
            // Autres éléments génériques par titre/aria-label
            const elements = document.querySelectorAll('[title], [aria-label]');
            elements.forEach(el => {
                const title = el.getAttribute('title');
                const ariaLabel = el.getAttribute('aria-label');
                
                // Mapper les textes anglais vers la langue courante
                Object.keys(currentTexts).forEach(key => {
                    if (title && title.toLowerCase().includes(key)) {
                        el.setAttribute('title', currentTexts[key]);
                    }
                    if (ariaLabel && ariaLabel.toLowerCase().includes(key)) {
                        el.setAttribute('aria-label', currentTexts[key]);
                    }
                });
            });
            
            console.log('✅ Textes OntoWave mis à jour pour', lang);
        }, 200);
    }

    // Fonction pour changer de langue
    function toggleLang(lang) {
        console.log('🔄 Bascule vers:', lang);
        
        // Masquer tous les contenus
        document.querySelectorAll('.lang-content').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('visible');
        });
        
        // Afficher le contenu de la langue sélectionnée
        const targetContent = document.getElementById('lang-' + lang);
        if (targetContent) {
            targetContent.classList.remove('hidden');
            targetContent.classList.add('visible');
        }
        
        // Mettre à jour les boutons
        document.querySelectorAll('.lang-toggle button').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeBtn = document.getElementById('btn-' + lang);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
        
        // Sauvegarder la préférence
        localStorage.setItem('ontowave-lang', lang);
        
        // Mettre à jour les textes de l'interface OntoWave
        updateOntoWaveTexts(lang);
        
        // Forcer la mise à jour des menus OntoWave après un délai supplémentaire
        setTimeout(() => {
            updateOntoWaveTexts(lang);
        }, 300);
        
        setTimeout(() => {
            updateOntoWaveTexts(lang);
        }, 800);
        
        // Forcer plusieurs recolorations Prism (le problème principal)
        console.log('🎨 Recoloration Prism immédiate');
        if (window.Prism && window.Prism.highlightAll) {
            window.Prism.highlightAll();
        }
        
        // Recoloration différée pour s'assurer que ça marche
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                console.log('🎨 Recoloration Prism différée 1');
                window.Prism.highlightAll();
            }
        }, 100);
        
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                console.log('🎨 Recoloration Prism différée 2');
                window.Prism.highlightAll();
            }
        }, 500);
        
        setTimeout(() => {
            if (window.Prism && window.Prism.highlightAll) {
                console.log('🎨 Recoloration Prism différée 3');
                window.Prism.highlightAll();
            }
        }, 1000);
    }
    </script>
</body>
</html>
